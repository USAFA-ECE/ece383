

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>üî¨ Lab 4: Direct Digital Synthesis &#8212; Embedded Systems II</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Assignments/lab4_orig';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece383.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/ece383.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE383 Embedded Computer Systems II
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">üö© Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">üìÜ Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vhdl_programming.html">üíª VHDL Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_programming.html">üíª C Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">üôã FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">üíé Resources</a></li>

<li class="toctree-l1"><a class="reference internal" href="../debugging.html">ü™≤ Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homeworks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="homework1.html">‚úèÔ∏è HW 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework2.html">‚úèÔ∏è HW 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework3.html">‚úèÔ∏è HW 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework4.html">‚úèÔ∏è HW 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework5.html">‚úèÔ∏è HW 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework7.html">‚úèÔ∏è HW 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework8.html">‚úèÔ∏è HW 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework8b.html">‚úèÔ∏è HW 8b</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework9.html">‚úèÔ∏è HW 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework12.html">‚úèÔ∏è HW 12</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">üî¨ Lab 1: VGA Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">üî¨ Lab 2: Data Acquisition, Storage and Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">üî¨ Lab 3: Software Control of a Datapath</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">üî¨ Lab 4: Direct Digital Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">üöÄ ECE 383 - Final Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ICEs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ice1.html">üî¨ ICE 1: Intro to Microblaze</a></li>
<li class="toctree-l1"><a class="reference internal" href="ice2.html">üî¨ ICE 2: Microblaze Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="ice3.html">üî¨ ICE 3: Microblaze Interrupts</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece383" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/USAFA-ECE/ece383/issues/new?title=Issue%20on%20page%20%2FAssignments/lab4_orig.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Assignments/lab4_orig.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>üî¨ Lab 4: Direct Digital Synthesis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">üìú Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">üíª Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hardware">Hardware</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#required-functionality">Required Functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-level-functionality">A-level Functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#milestone-1">Milestone 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#milestone-2">Milestone 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#readme">README</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-4-direct-digital-synthesis">
<h1>üî¨ Lab 4: Direct Digital Synthesis<a class="headerlink" href="#lab-4-direct-digital-synthesis" title="Permalink to this heading">#</a></h1>
<section id="objectives">
<h2>üìå Objectives<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The goal of this lab is to generate an audio waveform of a desired frequency with a high degree of accuracy.</p></li>
</ul>
</section>
<section id="synopsis">
<h2>üìú Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this heading">#</a></h2>
<p>You are to use Direct Digital Synthesis to reproduce your audio waveform. For required functionality your system should create a sinusoid.  It is your responsibility to get the samples for this waveform. I would suggest either deriving the waveform using a program like Python, Java, Matlab, or using a spreadsheet. Here is an example spreadsheet to create the BRAM initialization text for a 1024 entry LUT <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/SineWaveLUT_1024.xlsx">SineWaveLUT_1024.xlsx</a> which you would need to modify for your size LUT. Here is a MATLAB example: <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/BRAM_LUT.m">BRAM_LUT.m</a> and a JAVA example: <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/BRAM_code.java">BRAM_code.java</a> Consult the handout from the DDS lessons for more details on how to accomplish this. These 3 examples also create an unsigned sine LUT, not a signed LUT, which you might want to modify.</p>
</section>
<section id="procedure">
<h2>üíª Procedure<a class="headerlink" href="#procedure" title="Permalink to this heading">#</a></h2>
<section id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h3>
<p>While you have the flexibility to design the waveform generator as you see fit, your system must meet the following requirements:</p>
<ul class="simple">
<li><p>Use an update rate of 48kHz</p></li>
<li><p>Your function generator should be able to create a maximum frequency of 12000 Hz.</p></li>
<li><p>Your function generator should be able to create a minimum frequency between a 0.5 Hz and 1.0 Hz (this is also the minimum change in frequency).</p></li>
<li><p>When your phase increment X = 1.0, the output frequency should be 200 Hz +/- 20 Hz.</p></li>
<li><p>Be able to generate a full amplitude waveform on your lab2 o‚Äôscope display.</p></li>
<li><p>Only one BRAM may be used for each channel.</p></li>
<li><p>A FSM must be used to control the datapath. (using FSM coding style taught in lesson 9)</p></li>
<li><p>Microblaze is not required, but may be used if desired in place of the FSM.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Since your update rate is given (48kHz) and the required frequency when X = 1.0 is given, you can apply the formula you learned in class to find a suitable LUT size.  Similarly, these requirements will drive your selection of Qxx.xx</p>
</div>
</section>
<section id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading">#</a></h3>
<p><s>You will have to create the block diagram for your lab4 function generator and upload it to GitHub for milestone 1. Your design must be segregated into a lab4 datapath and a lab4 control unit, and will need your lab2 control unit and a modified lab2 datapath. Your design must show the all the needed BBB design blocks in the lab4 datapath, the states in the FSM, the control word, and the status word joining the datapath and control unit. All bus widths and Q formats for registers must be shown. This diagram must be neat and readable.</s></p>
<p>Here is a draft of the top_level <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/Lab4_Block_Diagram.pptx">Lab 4 Block Diagram</a> and a draft of a portion of the example Lab4_datapath block diagram, <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/Interpolation_block_diagram.pptx">Interpolation Block Diagram</a> you can use as a starting point.</p>
<p>The final value for your left (un-interpolated) and right (interpolated) signal you generate will be connected to the Codec‚Äôs L_Bus_in and R_Bus_in (signed values) so you can listen to the output tones using ear-buds or a speaker, and will also be sent to your Lab2 O‚ÄôScope, so a good insertion point would be where your lab2 datapath receives the L_Bus_Out and R_Bus_Out (signed values). Since you created an O‚ÄôScope in Lab2, you will use this to see your output signal on your monitor. Since your lab4 FSM and lab4 datapath will need the Audio_Codec_Wrapper (with Clock_Wiz_1) and ‚ÄúReady‚Äù signal from Lab2, put your Lab4 FSM and Lab4 datapath inside your lab2 block diagram (see <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/Lab4_Block_Diagram.pptx">Lab4_Block_Diagram</a>). Therefore, you will also turn in a modified Lab2 block diagram showing the interface to the Lab4 FSM and Lab4 datapath for milestone 1. So you can easily test if your lab2 is working, switch(2) will be used to select lab2 or 4, for lab2 selecting the audio codec L_bus_out and R_bus_out as inputs, and for lab4 selecting your uninterpolated and interpolated signals to send to the Lab2 video.</p>
<p><s>For lab4, you will use switch(5:4) to select 4 pre-calulated phase-increments (see milestone 1) for 4 output frequencies</s> (see <a class="reference external" href="https://georgeyork.github.io/ECE383_web/lab/lab4/Interpolation_block_diagram.pptx">Interpolation Block Diagram</a> ):
<s>- Exactly 2 Cycles of Sinusiod on Scopeface Monitor</s>
<s>- 440 hz</s>
<s>- Phase_increment = X = 1.0</s>
<s>- low frequency such that you can see the difference between uninterpolated and interpolated on the monitor</s></p>
<ul class="simple">
<li><p>Choose a frequency so that you can see exactly 1.5 cycles of a sine wave on your display.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Think about how many pixels across your scopeface display is.  If each horizontal pixel corresponds to a sample and you know your sample rate you should be able to find the period that corresponds to half of the drawing area.</p>
</div>
<p>Also for lab4,
<s>- Switch(7:6) will be used to amplify or attenuate the signal.</s></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Signed Multiplication with Unsigned Data: Our VHDL multiplier does signed multiplication, not unsigned multiplication. It assumes the numbers being multiplied are signed, not unsigned. (For example, if the two numbers being multiplied have a ‚Äò1‚Äô in the MSB, it assumes they are negative and produces a positive result, with a ‚Äò0‚Äô in the MSB. So, if your two numbers were really intended to be unsigned positive numbers, you might get the wrong result).</p>
</div>
<p>In the interpolation data flow shown in the block diagram linked above, the flow is assumed to be signed values, and it is assumed your BRAM has stored your sine LUT as signed values. Therefore, if you created your BRAM sine LUT with 16-bit unsigned values, after you read out these BRAM values, you will first need to convert them to signed values, doing something like this:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="n">data_out_signed</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">data_out_unsigned</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x8000</span><span class="p">;</span>
</pre></div>
</div>
<p>For your interpolator datapath block diagram, be sure to know if your BRAM LUT is composed of 16-bit signed values or 16-bit unsigned values, and add a conversion block if needed.</p>
<p>Looking at the data flow going into the two multipliers, the above ensured NEXT and BASE are signed. However, OFFSET and the AMPLIFY_SWITCHES are unsigned.</p>
<ul class="simple">
<li><p>We need to fool the signed multiplier into treating OFFSET and the AMPLIFY_SWITCHES as a signed number. Signed numbers are only negative when the MSb is a ‚Äú1‚Äù. If the MSb is a ‚Äò0‚Äô, it is positive, it is unsigned. Therefore, you need to append a ‚Äò0‚Äô to the MSb of OFFSET and the AMPLIFY_SWITCHES before the multiply, which ensures the answer will be correct, and then there will be an extra MSb in the answer you should delete. The final answer your send to the audio codec or to your lab2 o‚Äôscope should be 18-bits, so you will also truncate off the lower bits you do not need.</p></li>
<li><p>Another reason to do the amplification while the data is still SIGNED, is amplifying a signed value gets bigger about zero (or your x-axis calibrated about row 220 on your scopeface). If you instead were to amplify UNSIGNED data, it will not grow centered on row 220.</p></li>
</ul>
</section>
</section>
<section id="deliverables">
<h2>üöö Deliverables<a class="headerlink" href="#deliverables" title="Permalink to this heading">#</a></h2>
<section id="required-functionality">
<h3>Required Functionality<a class="headerlink" href="#required-functionality" title="Permalink to this heading">#</a></h3>
<p><s>Use switch(5:4) to demonstrate your system can generate the 4 different frequencies.</s> Just need to show you can create a sine wave and interpolate it. For required functionality, Interpolation between the output samples is not required. The waveform should be played back through the Audio Codec interface on the left channel producing an audible tone on a speaker and the appropriate waveform should be displayed on your lab2 scopeface monitor. Remember to wait for the ready signal.</p>
<p><s>### B-level Functionality</s>
<s>Switch(7:6) must be able to amplify or attenuate the signal to 4 different amplification levels. The signal must be equally amplified about the DC axis (row = 220).</s></p>
<p><s>For B-level Functionality interpolation between the output samples is not required.</s></p>
</section>
<section id="a-level-functionality">
<h3>A-level Functionality<a class="headerlink" href="#a-level-functionality" title="Permalink to this heading">#</a></h3>
<p>Modify the hardware for the right channel to interpolate between samples using (base + (next-base)*offset) method. You must create the Interpolated signal (for channel 2), you also must create the un-interpolated signal (for channel 1), so you can compare ch1 and ch2 to see the difference (and include an image of your scopeface monitor showing this difference).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This does NOT require duplicate hardware, since in calculating the interpolated signal, you also already create the un-interpolated signal (known as BASE).  However, you will need to amplify the BASE the same way you amplify the interpolated signal before if goes to channel 2.</p>
</div>
<p><s>You may swap A and B functionality if desired.</s></p>
<p><s>### Bonus Functionality</s>
<s>Modify your design to continuously create a ‚Äúchirp‚Äù signal, by continuously incrementing the phase increment (with an appropriate time delay  between increments), and demonstrate using a speaker.</s></p>
</section>
<section id="milestone-1">
<h3>Milestone 1<a class="headerlink" href="#milestone-1" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[15 Points]</strong> <s>At the COB of the day of the first lab session,</s> With your final lab turn-in you should have completed your design and uploaded it to github. This should include the mathematical analysis you did to meet the requirements in the ‚ÄúRequirements‚Äù section above, and answering the following questions.
(0) Given the mathematical analysis you did to meet the requirements in the ‚ÄúRequirements‚Äù section above, what is the Q format required for your index.offset register (like Qxx.xx)? Given this Q format, answer and show calculations for the following questions:
(1) phase increment needed for the maximum frequency of 12,000 Hz. Give this answer in decimal and in binary in the proper Q format.
(2) the size of the BRAM buffer needed, assuming it contains one cycle of a sinusoid
(3) the minimum frequency produced
(4) the frequency produced when your phase increment is 1.0
(5) the phase increment value that gets you closest to 440Hz. Give the answer in both decimal and in binary Q format.
(6) what that closest frequency to 440 Hz is that you can create.
[Hint: We did these calculations in the last slides of the DDS lesson]
To determine the frequency of your signals on the scopeface monitor, we need to know what the time axis is for the lab2 O‚Äôscope you created. [Remember: frequency = 1/(period of one cycle)] You are filling your lab2 BRAM at a rate of 48KHz, so each scopeface pixel (or column count) corresponds in time to 1/(48 kHz) = 20.8333333 micro-seconds. You are drawing the wave from column 20 to 620, or 600 pixels.
(7) how long in time do these 600 pixels represent?
Your scopeface grid should have 10 major grid blocks, each with a width of 60 pixels.
(8) how long in time do these grid blocks represent?
(9) If your function generate creates a sine wave such that exactly two cycles of the sinewave fit on your scopeface (ie., across 600 pixels), what is the frequency of this sine wave?
(10) What must your phase increment be to generate this sine wave?</p></li>
</ul>
<p>You should also include the hardware block diagram design and the State Machine design for the items listed in the ‚ÄúHardware‚Äù section above [the lab4 and modified lab3 block diagrams]. The block diagrams must look professional and not sloppy.
(11)The datapath for the lab4 interpolation hardware.</p>
<ul class="simple">
<li><p>All signals outside the components must have their width defined (if more than one bit) as well as be labeled with their names. The Q format should be specified on the BBBs where appropriate.</p></li>
<li><p>Here is a draft of a portion of the example Lab4 block diagram, Interpolation Block Diagram</p></li>
</ul>
<p>(12) The FSM state transition diagram and CW output table
(13) The overall top-level lab4 block diagram modified from the old lab2 diagram, showing blocks for the lab4 datapath, lab4 FSM, and how they interact with the remaining lab2 components.</p>
</section>
<section id="milestone-2">
<h3>Milestone 2<a class="headerlink" href="#milestone-2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[15 Points]</strong> <s>At the COB of the day of the second lab period,</s> With your final lab turn-in you should have a working testbench testing your lab4 interpolation hardware block diagram (with your BRAM LUT inside) and lab4 FSM. When simulating your design, you can have the testbench supply a mock system clock (100 MHz) and a mock ready signal (clock at 48 kHz) in place of the ready signal generated the Audio_Codec_Wrapper.</p></li>
</ul>
<p>You do not need to have your switches working for this test bench nor interfacing with your lab2 FSM or lab2 datapath.</p>
<p>Have the testbench test the interpolation of at least four cases, two cases for positive NEXT and BASE and two cases for negative NEXT and BASE, and for each pair of cases have one such that NEXT is greater than BASE and the other such that BASE is greater than NEXT. Also do a simulation that increases the amplitude and one that decreases the amplitude with the amplitude multiplier.</p>
<p>When complete, I expect your timing diagram to contain at least:</p>
<ul class="simple">
<li><p>clk (simulated using CSA statements in testbench)</p></li>
<li><p>reset (simulated using CSA statements in testbench)</p></li>
<li><p>ready (simulated using CSA statements in testbench)</p></li>
<li><p>FSM state</p></li>
<li><p>Phase increment</p></li>
<li><p>Index.Offset register</p></li>
<li><p>BRAM address</p></li>
<li><p>BRAM data out [alternating Base and Next]</p></li>
<li><p>Base</p></li>
<li><p>Next</p></li>
<li><p>Delta [Next - Base]</p></li>
<li><p>Delta_Offset [ Delta*Offset]</p></li>
<li><p>Interpolated [Base + Delta*Offset]</p></li>
<li><p>Amp_Interpolated [Amplitude * Interpolated]</p></li>
</ul>
<p>You need to describe in words and math what we are seeing in your simulation plot, to justify that your VHDL code is working (do not only include the plot with no description) For example, from a hypothetical plot</p>
<ul class="simple">
<li><p>NEXT = x03C0 = 00000011.11000000b = 3.75d</p></li>
<li><p>BASE = x0180 = 00000001.10000000b = 1.50d</p></li>
<li><p>so BASE-NEXT should be 2.25d</p></li>
<li><p>and the simulation plot shows x0240 = 00000010.01000000b = 2.25d</p></li>
<li><p>To save you time converting from Hex to Binary to Decimal, Vivado‚Äôs testbench simulation plot can help you with this analysis by automatically converting the values into decimal given a certain Q-format. If you do your simulation plot like this then you can greatly simplify your mathematical proof to me that your code works by just showing me the expected and actual math values for each step in DECIMAL, and not need to show the HEX and BINARY math. To do this, you right-click on a signal name ‚Äì&gt; select radix ‚Äì&gt; select Real Settings‚Äì&gt; select Fixed Point ‚Äì&gt; select either signed or unsigned, and then choose your binary point</p></li>
<li><p>Here is a plot I made doing this for an example signed interpolation:</p></li>
</ul>
<a class="reference internal image-reference" href="https://georgeyork.github.io/ECE383_web/lab/lab4/simulation_signed_tb.JPG"><img alt="https://georgeyork.github.io/ECE383_web/lab/lab4/simulation_signed_tb.JPG" class="align-center" src="https://georgeyork.github.io/ECE383_web/lab/lab4/simulation_signed_tb.JPG" style="width: 640px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above plot is just a testbench testing the interpolation math. This plot is missing signals clk, reset, ready, FSM state, Phase increment, Index.Offset, BRAM address, BRAM data, which are also needed for Milestone 2.</p>
</div>
<p>For Milestone 2, also describe your method for creating your BRAM look-up tables for your waveforms in your README, and upload any code (like spreadsheets or python code) used. Here is an example spreadsheet to create the BRAM initialization text for a 1024 entry LUT SineWaveLUT_1024.xlsx which you would need to modify for your size LUT.</p>
</section>
<section id="readme">
<h3>README<a class="headerlink" href="#readme" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>[10 Points]</strong> The README writeup should include:</p></li>
<li><p><strong>Milestone 1</strong> products (Design and solutions to the 13 design questions)</p></li>
<li><p><strong>Milestone 2</strong> simulation results and description of your method for creating your BRAM look-up tables for your waveforms (also upload any code like spreadsheets used.)</p></li>
<li><p><strong>Proof</strong> (such as a stream or YouTube video) that you met Required, B, and A functionality (or statement you demonstrated to your instructor), with the date/time.</p></li>
</ul>
<hr class="docutils" />
<p>For <strong>Required functionality</strong>, did your audio out work? Include images and analysis of your scopeface plots showing:</p>
<ol class="arabic simple">
<li><p>The output waveform when x is set to produce exactly 2 cycles of a sine wave across the 600 pixels on your scopeface display (did this produce exactly two cycles of your sine wave? does this match your calculated frequency, based on your scopeface grid timing calculations? <s>What is the percentage error? show calculations.</s>)</p></li>
</ol>
<p><s>For B-level functionality, include images of scopeface plots showing (1) the output waveform with your default amplitude, and (2) the output waveform after you increase (or decrease) the amplitude of your signal [does this match your calculations based on the switch settings? You should be comparing the relative amplitudes seen for the peak-to-peak signals displayed on your scope with the two different amplitude settings.]</s></p>
<p>For A-level functionality, include an image of your o‚Äôscope plot showing channel-1 (not interpolated) and channel-2 (interpolated). Try to pick a frequency such that interpolated looks better than non-interpolated.</p>
<ul class="simple">
<li><p>Remember to upload your code with proper headers and comments</p></li>
<li><p><strong>Results</strong> - Since we no longer use the printed lab cutsheets signed by your instructor as you meet each milestone, this section should clearly state for each milestone/functionality the date/time it was achieved, level of achievement (e.g, achieved, partially-achieved, not achieved), what was achieved, and how you proved it (via demo or evidence like images/videos). For example, you could have a table like this:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Milestone</p></th>
<th class="head"><p>Date/Time</p></th>
<th class="head"><p>What was achieved</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Gate Check 1</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>Gate Check 2</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>Required Functionality</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>B Functionality</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>A Functionality</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>Grading</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Points</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Milestone #1</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-odd"><td><p>Milestone #2</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-even"><td><p>Required Functionality</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>B Functionality</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>A Functionality</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>Bonus Functionality</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>Use of Git / Bitbucket</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>Code Style</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>README</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Total</strong></p></td>
<td><p><strong>100</strong></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">üìú Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure">üíª Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hardware">Hardware</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#required-functionality">Required Functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-level-functionality">A-level Functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#milestone-1">Milestone 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#milestone-2">Milestone 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#readme">README</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By James Trimble
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>